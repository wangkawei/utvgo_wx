<!DOCTYPE html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
	<meta name="renderer" content="webkit"><!-- 国产双核浏览器，启用极速模式 -->
	<meta name="HandheldFriendly" content="true" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Expires" content="-1">
	
	<meta http-equiv="Cache-Control" content="no-transform">
	<meta charset="utf-8">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-touch-fullscreen" content="yes">
	<meta name="full-screen" content="yes">
	<meta name="screen-orientation" content="portrait">
	<meta name="x5-fullscreen" content="true">
	<meta name="360-fullscreen" content="true">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<meta name="mobile-web-app-status-bar-style" content="black" />
	<meta name="apple-touch-fullscreen" content="yes"/>
	<meta name="touch-fullscreen" content="yes"/>
	
    <title></title>
    <link rel="stylesheet" href="./res/css/base.css?v=f64bdde28d" />
    <link rel="stylesheet" href="./res/css/idangerous.swiper.css?v=a769a5281c" />
    <link rel="stylesheet" href="./res/css/main.css?v=04a88012cb" />
    <style type="text/css">
		html,body{
			background-color: #394b73;
			height: auto;
		}
    </style>
    <script type="text/javascript">
    
    </script>
</head>
<body style="" class="overflow-scroll-y">
	
	<div id="dyDetailTop" class="clearfix dyDetail-top">
		<!-- <div class="dyDetailTop-img"><img src="./res/images/3.jpg?v=e4a168b45e" /></div>
		<div class="dyDetail-top-text">
			<table>
				<tbody>
					<tr>
						<td class="dyDetail-top-item-name">年份：</td>
						<td>2015</td>
					</tr>
					<tr>
						<td class="dyDetail-top-item-name">类型：</td>
						<td>家庭剧；言情据，都市据</td>
					</tr>
					<tr>
						<td class="dyDetail-top-item-name">主演：</td>
						<td>李克勤、习大大、彭丽媛、成龙</td>
					</tr>
					<tr>
						<td class="dyDetail-top-item-name">导演：</td>
						<td>谢文东</td>
					</tr>
					<tr>
						<td class="dyDetail-top-item-name">语言：</td>
						<td>英语</td>
					</tr>
				</tbody>
			</table>
		</div> -->
	</div>
	<div id="dySourceBar" class="dySourceBar">
		<!-- <div style="padding-bottom: 10px;">播放来源:</div>
		<div class="clearfix">
			<a href="#" class="sourceItem">PPTV</a>
			<a href="#" class="sourceItem">PPTV</a>
			<a href="#" class="sourceItem">PPTV</a>
		</div> -->
	</div>
	<div class="detailTabBox">
		<!-- <div class="detailTabBar col2 clearfix">
			<div class="detailTabItem on">
				<span class="detailTab-text">猜你喜欢</span>
			</div>
			<div class="detailTabItem">
				<span class="detailTab-text">简介</span>
			</div>
		</div>
		<div class="detailTabItemContent indexContentBox">
			<div class="rmdy-item">
				<a href="#" class="rmdy-item-link"><img src="./res/images/3.jpg?v=e4a168b45e" />
				<p class="rdzx-text ellipsis">高考确定键三闾</p></a>
			</div>
		</div>
		<div class="detailTabItemContent">
			<div class="detail-profile">
			《山炮进城》讲述的是几个农村人进城奋斗的故事，人人都有一部血泪史，其实也是一部励志史
			</div>
		</div> -->
	</div>
	<div class="loadingTip"><div class="loadingTipImg"></div></div>

	<script type="text/javascript" src="./res/js/lib/zepto-1.1.6.js?v=8155cb4235"></script>
	<script type="text/javascript" src="./res/js/lib/fx.js?v=ca467e4b03"></script>
	<script type="text/javascript" src="./res/js/lib/fx_methods.js?v=2aabbf9887"></script>
	<script type="text/javascript" src="./res/js/lib/idangerous.swiper.js?v=e61af1cb6a"></script>
	<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>

	<script type="text/javascript" src="./res/js/main.js?v=59d8e3fa07"></script>
	<script type="text/javascript">
	var urlParaObj=getUrlPara();//contentId=31996
	var channelId=urlParaObj.channelId||0;
	var contentId=urlParaObj.contentId||0;
	var type=urlParaObj.type||'dy';
	if(type=='dm'){
		type='dsj';
	}

	function getdata(){
		//serverAddress+'/utvgoClient/interfaces/hdtvContent_'+type+'Detail.action'
		var url=serverAddress+'/utvgoClient/tvutvgo/channel/ajaxDetail.action';
		//channelId=10085&boxId=9287&zoneid=17&pagesize=1000
		$.ajax({
		  type: 'GET',
		  url: url,
		  // data to be added to query string:
		  data: {channelId:channelId,boxId:contentId,zoneId:17,pagesize:1000},
		  // type of data we are expecting in return:
		  dataType: 'json',
		  success: function(data){

		    renderDetailTop(data);

		    renderDetailTab(data);
		  },
		  error: function(xhr, type){
		    //alert('network error!');
		  }
		});
	}
	getdata();
	function renderDetailTop(data){
		document.title=data.snet_ContentBox.contentName;
		if(data.snet_ContentBox.tvgoImg.indexOf('http://')==-1){
			data.snet_ContentBox.tvgoImg=imgBasePath+data.snet_ContentBox.tvgoImg;
		}
		var typename=[];
		if(!!data.typeList&&data.typeList.length>0){
			for(var ii= 0,iilen=data.typeList.length;ii<iilen;ii++){
				typename.push(data.typeList[ii].typename);
			}
			typename=typename.join(',');
		}else{
			typename='';
		}

		var s='<div class="dyDetailTop-img"><img src="'+data.snet_ContentBox.tvgoImg+'" /></div> <div class="dyDetail-top-text"> <table> <tbody> <tr> <td class="dyDetail-top-item-name">年份：</td> <td>'+data.snet_ContentBox.playTime.split(' ')[0]+'</td> </tr> <tr> <td class="dyDetail-top-item-name">类型：</td> <td>'+typename+'</td> </tr> <tr> <td class="dyDetail-top-item-name">主演：</td> <td>'+data.snet_ContentBox.player+'</td> </tr> <tr> <td class="dyDetail-top-item-name">导演：</td> <td>'+data.snet_ContentBox.director+'</td> </tr> <tr> <td class="dyDetail-top-item-name">语言：</td> <td>'+(!!data.lan ? data.lan.lanname :'-')+'</td> </tr> </tbody> </table> </div>';

		$('#dyDetailTop').html(s);
		s='';

		var contentBox=data.snet_ContentBox;
		var pm=data.pm||{};
		//./play_sn.html?playName='+encodeURIComponent(data[i].recommendContentName||data[i].contentName)+'&playUrl='+encodeURIComponent(data[i].playUrl||data[i].tvgoPlayurl)+'&playImg='+encodeURIComponent(data[i].tvgoImg)+'&contentId='+encodeURIComponent(data[i].contentId)+'&col='+(data[i].mediaNumber>1 ? 3 : 3)+'&type='+encodeURIComponent('qi')+'&mediaNumber='+encodeURIComponent(data[i].mediaNumber)
		s='<a href="./play_sn.html?playName='+encodeURIComponent(contentBox.recommendContentName||contentBox.contentName)+'&playUrl='+(contentBox.playUrl||contentBox.tvgoPlayurl||pm.records[0].playUrl||pm.records[0].tvgoPlayurl)+'&playImg='+encodeURIComponent(contentBox.tvgoImg)+'&currentIndex=0&boxId='+contentId+'&channelId='+contentBox.channelId+'&contentId='+encodeURIComponent(contentBox.contentId)+'&col='+((pm.records.length>0&&data.snet_ContentBox.utvgotvsupplierid>0) ? 3 : 2)+'&type='+((pm.records.length>0&&data.snet_ContentBox.utvgotvsupplierid>0) ? 'ji' : 'dy')+'&mediaNumber='+encodeURIComponent(pm.records.length)+'" class="sourceItem">'+'立即播放'+'</a>';


		var ss='<div style="padding-bottom: 10px;"><!--播放来源:--></div> <div class="clearfix"> '+s+' </div>';
		$('#dySourceBar').html(ss);
	}
	function renderDetailTab(data){

		var contentBox=data.snet_ContentBox;
		if(data.pm&&data.pm.records&&data.pm.records.length>0&&contentBox.utvgotvsupplierid>0){
			type='dsj';
		}
		var col=2;
		var s='';
		if(type=='dy'){
			col=2;
			s+='<div class="detailTabBar col'+col+' clearfix"> <div class="detailTabItem"> <span class="detailTab-text">猜你喜欢</span> </div> <div class="detailTabItem"> <span class="detailTab-text">简介</span> </div> </div>';
			var lkList='';
			/*
			var items=data.result.relatives||[];
			for(var i=0,len=items.length;i<len;i++){
				lkList+='<div class="rmdy-item"> <a href="./dyDetail.html?contentId='+items[i].id+'&type='+type+'" class="rmdy-item-link"><img src="'+items[i].img+'" /> <p class="rdzx-text ellipsis">'+items[i].name+'</p></a> </div>';
			}
			 */
			s+='<div class="detailTabItemContent indexContentBox clearfix dyDetail-likeListBox">'+lkList+'</div>';
			s+='<div class="detailTabItemContent"> <div class="detail-profile"> <p>'+contentBox.remark.replace('\r\n','</p><p>')+'</p></div> </div>'
		}

		if(type=='dsj'){
			col=3;
			s+='<div class="detailTabBar col'+col+' clearfix"> <div class="detailTabItem"> <span class="detailTab-text">选集</span> </div> <div class="detailTabItem"> <span class="detailTab-text">猜你喜欢</span> </div> <div class="detailTabItem"> <span class="detailTab-text">简介</span> </div> </div>';
			var jiList='';

			var items=data.pm.records||[];
			var playPageHref='';
			for(var i=0,len=items.length;i<len;i++){
				if(items[i].tvgoImg.indexOf('http://')==-1){
					items[i].tvgoImg=imgBasePath+items[i].tvgoImg;
				}
				playPageHref='./play_sn.html?playName='+encodeURIComponent(items[i].contentName)+'&playUrl='+(items[i].playUrl||items[i].tvgoPlayurl)+'&playImg='+encodeURIComponent(items[i].tvgoImg)+'&currentIndex='+i+'&boxId='+contentId+'&channelId='+items[i].channelId+'&contentId='+encodeURIComponent(items[i].contentId)+'&col='+( 3 )+'&type='+('ji')+'&mediaNumber='+encodeURIComponent(len);
				jiList+='<a href="'+playPageHref+'" class="detail-jiList-item">'+items[i].recommendContentName+'</a>';
			}

			s+='<div class="detailTabItemContent detail-jiList clearfix">'+jiList+'</div>';

			var lkList='';
			/*
			var items=data.result.relatives||[];
			for(var i=0,len=items.length;i<len;i++){
				lkList+='<div class="rmdy-item"> <a href="./dyDetail.html?contentId='+items[i].id+'&type='+type+'" class="rmdy-item-link"><img src="'+items[i].img+'" /> <p class="rdzx-text ellipsis">'+items[i].name+'</p></a> </div>';
			}
			*/
			s+='<div class="detailTabItemContent indexContentBox clearfix dyDetail-likeListBox">'+lkList+'</div>';

			s+='<div class="detailTabItemContent"> <div class="detail-profile"> <p>'+contentBox.remark.replace('\r\n','</p><p>')+'</p></div> </div>'
			//保存集数据到本地
			try{
				localStorage.setItem('duojiDatas',JSON.stringify(data.pm.records));
			}catch(err){}
		}
		$('.detailTabBox').each(function(i,n){
			$(n).html(s);
		});


		detailTabInitShow();
		getLikeData();
	}

	function getLikeData(){
		showLoading();
		var offset=0;
		var pageSize=10;
		var pageNo=1;
		var yearId=0;
		var areaId=0;
		var typeId=0;
		////utvgoClient/tvutvgo/channel/ajaxList.action?channelId=5&pagesize=10&pager.offset=0&typeId=10470
		var url=serverAddress+'/utvgoClient/tvutvgo/channel/ajaxList.action';
		$.ajax({
			type: 'GET',
			url: url, //serverAddress+'/utvgoClient/interfaces/hdtvContent_listChannelData.action'
			// data to be added to query string:
			data: {channelId:channelId,pagesize:pageSize,'pager.offset':offset,pageNo:pageNo,year:yearId,typeId:typeId,areaId:areaId},
			// type of data we are expecting in return:
			dataType: 'json',
			success: function(data){
				hideLoading();
				if(!!!data||!!!data.pm){
					//最后一页了，设置ajaxMore避免再请求
					return;
				}
				renderLikeList(data.pm.records||[]);
			},
			error: function(xhr, type){
				hideLoading();
				//alert('network error!');
			}
		});	
	}

	function renderLikeList(data){
		var s='';
		var items=data||[];
		for(var i=0,len=items.length;i<len;i++){
			//?channelId=10086&contentId=9319&type=dsj
			if(items[i].tvgoImg.indexOf('http://')==-1){
				items[i].tvgoImg=imgBasePath+items[i].tvgoImg;
			}
			if(parseInt(items[i].contentId,10)==parseInt(contentId,10)){
				continue;
			}
			s+='<div class="rmdy-item"> <a data-href="./dyDetail.html?channelId='+items[i].channelId+'&contentId='+items[i].id+'&type='+type+'" onclick="likeListClick(this);" class="rmdy-item-link"><img src="'+items[i].tvgoImg+'" /> <p class="rdzx-text ellipsis">'+items[i].contentName+'</p></a> </div>';
		}
		if(items.length<=0){
			s='<div>无数据！</div>';
		}
		$('.dyDetail-likeListBox').html(s);
		setTimeout(function(){
			// var w=$('.rmdy-item-link').width();
			// if(!!!w){
			// 	return;
			// }
			var w=$('body').width();
			w=(w-(11*4))/3;
			var h=w/(210/280);
			$('.rmdy-item-link img').height(h);
		},0);
	}
	function likeListClick(el){
		var url=$(el).attr('data-href');
		window.location.replace(url);
	}

	</script>
</body>


</html>
